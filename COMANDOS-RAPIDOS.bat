@echo off
chcp 65001 >nul
color 0A
title Macro Manager - Menú de Compilación

:MENU
cls
echo ????????????????????????????????????????????????????????????????
echo ?          MACRO MANAGER - MENÚ DE COMPILACIÓN                ?
echo ????????????????????????????????????????????????????????????????
echo.
echo   [1] ?? Compilar solo ejecutable (Rápido)
echo   [2] ?? Compilar + Crear Instalador (Requiere Inno Setup)
echo   [3] ??  Ejecutar aplicación (modo debug)
echo   [4] ?? Limpiar proyecto
echo   [5] ?? Abrir carpeta de publicación
echo   [6] ?? Abrir carpeta de instaladores
echo   [0] ? Salir
echo.
echo ??????????????????????????????????????????????????????????????
echo.

set /p opcion="   Selecciona una opción (0-6): "

if "%opcion%"=="1" goto COMPILAR_EXE
if "%opcion%"=="2" goto COMPILAR_INSTALLER
if "%opcion%"=="3" goto EJECUTAR
if "%opcion%"=="4" goto LIMPIAR
if "%opcion%"=="5" goto ABRIR_PUBLISH
if "%opcion%"=="6" goto ABRIR_OUTPUT
if "%opcion%"=="0" goto SALIR

echo.
echo   ? Opción inválida
timeout /t 2 >nul
goto MENU

:COMPILAR_EXE
cls
echo ??????????????????????????????????????????????????????????????
echo   ?? COMPILANDO EJECUTABLE...
echo ??????????????????????????????????????????????????????????????
echo.
powershell -ExecutionPolicy Bypass -File ".\build-exe.ps1"
echo.
echo ??????????????????????????????????????????????????????????????
pause
goto MENU

:COMPILAR_INSTALLER
cls
echo ??????????????????????????????????????????????????????????????
echo   ?? COMPILANDO Y CREANDO INSTALADOR...
echo ??????????????????????????????????????????????????????????????
echo.
powershell -ExecutionPolicy Bypass -File ".\build-installer.ps1"
echo.
echo ??????????????????????????????????????????????????????????????
pause
goto MENU

:EJECUTAR
cls
echo ??????????????????????????????????????????????????????????????
echo   ??  EJECUTANDO APLICACIÓN (Modo Debug)...
echo ??????????????????????????????????????????????????????????????
echo.
dotnet run --project MacroManager
echo.
echo ??????????????????????????????????????????????????????????????
pause
goto MENU

:LIMPIAR
cls
echo ??????????????????????????????????????????????????????????????
echo   ?? LIMPIANDO PROYECTO...
echo ??????????????????????????????????????????????????????????????
echo.
dotnet clean
echo.
echo   ? Proyecto limpiado
echo.
echo ??????????????????????????????????????????????????????????????
pause
goto MENU

:ABRIR_PUBLISH
cls
echo ??????????????????????????????????????????????????????????????
echo   ?? Abriendo carpeta de publicación...
echo ??????????????????????????????????????????????????????????????
if exist "MacroManager\bin\Release\net8.0-windows\win-x64\publish" (
    explorer.exe "MacroManager\bin\Release\net8.0-windows\win-x64\publish"
    echo   ? Carpeta abierta
) else (
    echo   ? No existe carpeta publish. Compila primero.
)
timeout /t 2 >nul
goto MENU

:ABRIR_OUTPUT
cls
echo ??????????????????????????????????????????????????????????????
echo   ?? Abriendo carpeta de instaladores...
echo ??????????????????????????????????????????????????????????????
if exist "Output" (
    explorer.exe "Output"
    echo   ? Carpeta abierta
) else (
    echo   ? No existe carpeta Output. Crea instalador primero.
)
timeout /t 2 >nul
goto MENU

:SALIR
cls
echo.
echo   ¡Hasta luego! ??
echo.
timeout /t 1 >nul
exit
